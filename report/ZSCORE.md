
در این بخش به نحوه کارکرد تابع فوق میپردازیم :
ابتدا با فورمول ها آشنا میشیم : $\mu$ که برابر میانگین نمونه است

این تابع هدف اصلی حذف داده های پرت است با استفاده از فرمول های انحراف از میانگین 
این تابع 2 ورودی میگیرد که یکی از انها دیتا ستمون هست که خام هست و دیگری دقت ربط به دقت حذف داده های پرت دارد.
حالا اصلا این تابع به چه نحوی کار میکند؟
میانگین که به این نحو است :
$$
\mu = \frac{1}{n} \sum_{i=1}^{n} x_i
$$
انحراف از معیار به این نحو است :
$$
\sigma = \sqrt{\frac{1}{n} \sum_{i=1}^{n} (x_i - \mu)^2}
$$
نمره استاندارد یا همون z-score شاخصی آماری است که نشان می‌دهد یک داده خاص چه فاصله‌ای از میانگین دارد بر حسب انحراف معیار :
$$
z_i = \frac{x_i - \mu}{\sigma}
$$

این تابع 2 ارگومان ورودی میگیرد یکی دیتا ست که 
داده های ما هستند و دیگیری دقت حذف انحراف از میانگین که به عنوان ورودی از کاربر گرفته میشود.
```c
  int key_columns[] = {3, 5, 7, 8}; // rooms, population, income, value
```
در اینجا ستون هایی که نیاز به حذف داده های پرت هستند اورده شده که نشان میدهد مختصات وسن موضوع بحث ما نیستند و تاثیر چندانی روی قیمت نخواهد گزاشت.


### ورودی‌ها

- `original` → دیتاست اصلی
- `z_threshold` → آستانه‌ی Z-Score  
- مثلا 2.5 یعنی: هر عددی که بیشتر از 2.5 انحراف معیار از میانگین فاصله داشته باشه، پرت حساب می‌شه

### خروجی

- یک **Dataset جدید** که داده‌های پرت ازش حذف شدن

## مرحله ۱: بررسی اولیه

`if (!original || original->count == 0) return NULL;`

اگر دیتاست وجود نداشته باشه یا خالی باشه :ادامه نمی‌دیم.
## مرحله ۲: ساخت دیتاست جدید

`Dataset *filtered = allocate_dataset();`

اینجا یه دیتاست خالی می‌سازیم تا فقط **داده‌های سالم** رو توش ذخیره کنیم.
## مرحله ۳: محاسبه‌ی میانگین هر ستون

`ColumnStats stats[9]; calculate_stats(original, stats);`

برای هر کدوم از **۹ ستون**:
 میانگیت
میانه
مد*
ماکس 
مین

  

 این میانگین‌ها پایه‌ی محاسبه‌ی Z-Score هستن.
 ##### مرحله ۴: محاسبه‌ی انحراف معیار هر ستون
 

`double stds[9];`

برای هر ستون:

1. روی همه‌ی داده‌ها حلقه می‌زنیم
2. مقادیر `NaN` رو نادیده می‌گیریم
3. فرمول انحراف معیار رو پیاده می‌کنیم:

 اگر ستونی داده‌ی معتبر نداشته باشه : std = 0
 ## مرحله ۵: مشخص کردن ستون‌های مهم

`int key_columns[] = {3, 5, 7, 8};`

 همه‌ی ستون‌ها مهم نیستن  
اینجا فقط این ستون‌ها بررسی می‌شن:

- تعداد اتاق‌ها
  
- جمعیت
 
- درآمد

- قیمت خانه
 
## مرحله ۶: محاسبه Z-Score برای هر رکورد

برای هر رکورد:

`double z_score = fabs((value - stats[col].mean) / stds[col]);`


اگر:

`z_score > z_threshold`

 این رکورد **پرت** محسوب می‌شه

---

## مرحله ۷: حذف یا نگه‌داری رکورد

- اگر **پرت نباشه** → به دیتاست جدید اضافه می‌شه
- اگر **پرت باشه** → حذف می‌شه و شمارنده زیاد می‌شه

`filtered->points[filtered->count] = *dp; filtered->count++;`

---

## مرحله ۸: گزارش نهایی

```c
printf("Removed %d outliers total\n", removed); printf("Kept %d records\n", filtered->count);
```
